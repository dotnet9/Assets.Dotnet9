## å‰è¨€

åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°è®¸å¤šéœ€è¦é€šè¿‡ç¨‹åºå‘é€é‚®ä»¶çš„åœºæ™¯ï¼Œæ¯”å¦‚å¼‚å¸¸æŠ¥è­¦ã€æ¶ˆæ¯ã€è¿›åº¦é€šçŸ¥ç­‰ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨åŸç”Ÿçš„SmtpClientç±»åº“å±…å¤šï¼Œå®ƒèƒ½æ»¡è¶³æˆ‘ä»¬ç»å¤§å¤šæ•°åœºæ™¯ã€‚ä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¸å¤Ÿç®€æ´ï¼Œè®¸å¤šåœºæ™¯éœ€è¦æˆ‘ä»¬è‡ªè¡Œå°è£…æ–¹æ³•å»å®ç°ï¼Œè€Œä¸”ä»£ç é‡éå¸¸å¯è§‚ã€‚åº†å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸€æ¬¾éå¸¸æ£’çš„ç»„ä»¶ï¼Œèƒ½æ»¡è¶³æˆ‘ä»¬ç»å¤§å¤šæ•°åº”ç”¨åœºæ™¯ï¼Œè€Œä¸”ä½¿ç”¨ç®€å•åŠŸèƒ½å¼ºå¤§ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è¯´çš„FluentEmailï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®é™…åœ¨é¡¹ç›®ä¸­æ­£åœ¨ä½¿ç”¨çš„é‚®ä»¶å‘é€ç»„ä»¶ã€‚å¦‚æœä½ ä»¬åœ¨.Net Coreä¸­æœ‰å‘é€é‚®ä»¶çš„éœ€æ±‚ï¼Œä¹Ÿæ¨èå»å°è¯•ä¸€ä¸‹ã€‚

## FluentEmail

FluentEmailæ˜¯ä¸€æ¬¾åœ¨GitHubä¸Šå¼€æºå…è´¹çš„æ”¯æŒ.Netå’Œ.Net Coreé‚®ä»¶å‘é€ç»„ä»¶ï¼Œç›®å‰å·²æœ‰1Kå¤šçš„Starï¼Œè€Œä¸”è¿‘ä¸¤å¹´éšç€.Net Coreçš„æ—¥ç›Šæˆç†Ÿï¼Œå®ƒçš„Starå¢é•¿è¶‹åŠ¿è¿˜æ˜¯éå¸¸è¿…çŒ›çš„ã€‚å®ƒåœ¨GitHubåœ°å€æ˜¯https://github.com/lukencode/FluentEmailï¼Œå®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§è€Œä¸”éå¸¸å®ç”¨ï¼Œæ”¯æŒRazorçš„é‚®ä»¶æ¨¡æ¿å’Œæ”¯æŒä½¿ç”¨SendGridï¼ŒMailGunï¼ŒSMTPå‘é€é‚®ä»¶ï¼Œè€Œä¸”ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ã€‚

## Nugetç»„ä»¶

FluentEmailåŠŸèƒ½å¼ºå¤§ï¼Œè€Œä¸”å¯¹ä¸åŒåœºæ™¯çš„æ”¯æŒéƒ½æœ‰ç‹¬ç«‹çš„NugetåŒ…ï¼Œè¿™ç§ä½è€¦åˆçš„æ‹†åˆ†ä¸ä»…ä½¿å¾—ä¾èµ–éå¸¸æ¸…æ™°ï¼Œè€Œä¸”é¿å…å¼•å…¥ä¸éœ€è¦çš„ä»£ç ï¼Œå…·ä½“åŠŸèƒ½åŒ…å«åœ¨ä»¥ä¸‹çš„ç»„ä»¶åŒ…ä¸­

- [FluentEmail.Core](https://github.com/lukencode/FluentEmail/tree/master/src/FluentEmail.Core) - åŸºç¡€æ ¸å¿ƒåŒ…ï¼ŒåŒ…å«äº†åŸºç¡€çš„æ¨¡å‹å®šä¹‰å’Œé»˜è®¤çš„è®¾ç½®ï¼Œè€Œä¸”ä»¥ä¸‹çš„å¼•ç”¨åŒ…éƒ½åŒ…å«äº†è¿™ä¸ªæ ¸å¿ƒåŒ…ã€‚
- [FluentEmail.Smtp](https://github.com/lukencode/FluentEmail/blob/master/src/Senders/FluentEmail.Smtp) - ä½¿ç”¨SMTPæœåŠ¡å‘é€é‚®ä»¶çš„ç¨‹åºåŒ…ã€‚
- [FluentEmail.Razor](https://github.com/lukencode/FluentEmail/blob/master/src/Renderers/FluentEmail.Razor) - é€šè¿‡Razoræ¨¡æ¿ç”Ÿæˆé‚®ä»¶å‘é€å†…å®¹ã€‚
- [FluentEmail.Mailgun](https://github.com/lukencode/FluentEmail/blob/master/src/Senders/FluentEmail.Mailgun) - ä½¿ç”¨Mailgunçš„Restæ¥å£å‘é€é‚®ä»¶ã€‚
- [FluentEmail.SendGrid](https://github.com/lukencode/FluentEmail/blob/master/src/Senders/FluentEmail.SendGrid) - ä½¿ç”¨SendGridæ¥å£å‘é€é‚®ä»¶ã€‚
- [FluentEmail.Mailtrap](https://github.com/lukencode/FluentEmail/blob/master/src/Senders/FluentEmail.Mailtrap) - å‘é€é‚®ä»¶Mailtrap, ä½¿ç”¨çš„æ˜¯FluentEmail.SmtpåŒ…è¿›è¡Œå‘é€.
- [FluentEmail.MailKit](https://github.com/lukencode/FluentEmail/blob/master/src/Senders/FluentEmail.MailKit) - ä½¿ç”¨MailKité‚®ä»¶åº“å‘é€é‚®ä»¶ã€‚

## æ™®é€šé‚®ä»¶æ–¹å¼

æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨FluentEmailå‘é€é‚®ä»¶ï¼Œç”±äºæˆ‘ä»¬å®é™…ä¸šåŠ¡ä¸­å¤§å¤šæ•°éƒ½ä½¿ç”¨çš„SMTPçš„æ–¹å¼å‘é€é‚®ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»¥æ­¤ä¸ºåšæ¼”ç¤ºï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¼•å…¥FluentEmail.SmtpåŒ…ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º2.8.0

```xml
<PackageReference Include="FluentEmail.Smtp" Version="2.8.0" />
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„å†™ä»£ç äº†ï¼Œå®ƒçš„ç¼–ç ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•è€Œä¸”éå¸¸ç®€æ´ï¼Œä¸»è¦é€šè¿‡é“¾å¼ç¼–ç¨‹çš„æ–¹å¼

```C#
//å¦‚æœä½¿ç”¨smtpæœåŠ¡å‘é€é‚®ä»¶å¿…é¡»è¦è®¾ç½®smtpæœåŠ¡ä¿¡æ¯
SmtpClient smtp = new SmtpClient
{
    //smtpæœåŠ¡å™¨åœ°å€(æˆ‘è¿™é‡Œä»¥126é‚®ç®±ä¸ºä¾‹ï¼Œå¯ä»¥ä¾æ®å…·ä½“ä½ ä½¿ç”¨çš„é‚®ç®±è®¾ç½®)
    Host = "smtp.126.com",
    UseDefaultCredentials = true,
    DeliveryMethod = SmtpDeliveryMethod.Network,
    //è¿™é‡Œè¾“å…¥ä½ åœ¨å‘é€smtpæœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç 
    Credentials = new NetworkCredential("é‚®ç®±ç”¨æˆ·å", "é‚®ç®±å¯†ç ")
};
//è®¾ç½®é»˜è®¤å‘é€ä¿¡æ¯
Email.DefaultSender = new SmtpSender(smtp);
var email = Email
    //å‘é€äºº
    .From("zhangsan@126.com")
    //æ”¶ä»¶äºº
    .To("lisi@qq.com")
    //æŠ„é€äºº
    .CC("admin@126.com")
    //é‚®ä»¶æ ‡é¢˜
    .Subject("é‚®ä»¶æ ‡é¢˜")
    //é‚®ä»¶å†…å®¹
    .Body("é‚®ä»¶å†…å®¹");
//ä¾æ®å‘é€ç»“æœåˆ¤æ–­æ˜¯å¦å‘é€æˆåŠŸ
var result = email.Send();
//æˆ–ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼å‘é€
//await email.SendAsync();
if (result.Successful)
{
    //å‘é€æˆåŠŸé€»è¾‘
}
else
{
    //å‘é€å¤±è´¥å¯ä»¥é€šè¿‡result.ErrorMessagesæŸ¥çœ‹å¤±è´¥åŸå› 
}
```

å¦‚æœä½ å‘é€çš„å†…å®¹ä¸­åŒ…å«htmlæ ¼å¼çš„å†…å®¹å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼

```C#
var email = Email
    //å‘é€äºº
    .From("zhangsan@126.com")
    //æ”¶ä»¶äºº
    .To("lisi@qq.com")
    //æŠ„é€äºº
    .CC("admin@126.com")
    //é‚®ä»¶æ ‡é¢˜
    .Subject("é‚®ä»¶æ ‡é¢˜")
    //åªéœ€è¦é¢å¤–è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueå³å¯
    .Body("<h1 align=\"center\">.NETå¤§æ³•å¥½</h1><p>æ˜¯çš„,è¿™ä¸€ç‚¹æ¯›ç—…éƒ½æ²¡æœ‰</p>",true);
//å‘é€
var result = email.Send();
```

è¿™ä¸ªæˆ‘ä»¬é€šè¿‡ç‚¹å‡»æŸ¥çœ‹Bodyçš„æ–¹æ³•å£°æ˜å³å¯å¾—çŸ¥ç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥è¡¨ç¤ºå†…å®¹æ˜¯å¦ä¸ºhtmlæ ¼å¼ï¼Œé»˜è®¤ä¸ºfalse

```C#
IFluentEmail Body (string body, bool isHtml = false);
```

å¦‚æœé‚®ä»¶çš„æ”¶ä»¶äººä¸ºå¤šä¸ªé‚®ç®±åœ°å€çš„è¯,å¯ä»¥é‡‡ç”¨Toæ–¹æ³•çš„å¦ä¸€ä¸ªé‡è½½æ–¹æ³•å¯ä»¥æ¥å—List<FluentEmail.Core.Models.Address>

```C#
var email = Email
    //å‘é€äºº
    .From("zhangsan@126.com")
    //é‚®ä»¶æ ‡é¢˜
    .Subject("é‚®ä»¶æ ‡é¢˜")
    //é‚®ä»¶å†…å®¹
    .Body("<h1 align=\"center\">.NETå¤§æ³•å¥½</h1><p>æ˜¯çš„,ä¸€ç‚¹æ¯›ç—…éƒ½æ²¡æœ‰</p>",true);

//æ„å»ºå¤šä¸ªæ¥æ”¶äººé‚®ç®±
string toUserStr = "oldwang@126.com;xiaoming@163.com;xiaoli@qq.com";
List<FluentEmail.Core.Models.Address> toUsers = toUserStr.Split(";")
    .Select(i => new FluentEmail.Core.Models.Address { EmailAddress = i }).ToList();
//æ”¯æŒä¼ å…¥Addressé›†åˆ
email.To(toUsers)
//æŠ„é€äººé›†åˆ
.CC(toUsers);
//å‘é€
var result = email.Send();
```

å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å‘é€çš„é‚®ä»¶ä¸­æ·»åŠ ä¸€ä¸ªé™„ä»¶çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Attacheæ–¹æ³•æ·»åŠ é™„ä»¶

```C#
var email = Email
        //å‘é€äºº
        .From("zhangsan@qq.com")
        //æ”¶ä»¶äºº
        .To("lisi@126.com")
        //æŠ„é€äºº
        .CC("admin@126.com")
        //é‚®ä»¶æ ‡é¢˜
        .Subject("å…³äº.Net Coreæ€ä¹ˆæ ·")
        //é‚®ä»¶å†…å®¹
        .Body("<h1 align=\"center\">.NET Core</h1><p>.Net Coreå¾ˆä¼˜ç§€å—ï¼Ÿæ˜¯çš„,ä¸€ç‚¹æ¯›ç—…éƒ½æ²¡æœ‰ï¼ï¼ï¼</p>",true);

//æ„å»ºé™„ä»¶
var stream = new MemoryStream();
var sw = new StreamWriter(stream);
sw.WriteLine("æ‚¨å¥½,è¿™æ˜¯æ–‡æœ¬é‡Œçš„å†…å®¹");
sw.Flush();
stream.Seek(0, SeekOrigin.Begin);
var attachment = new FluentEmail.Core.Models.Attachment
{
    Data = stream,
    ContentType = "text/plain",
    Filename = "Hello.txt"
};
//æ·»åŠ é™„ä»¶
email.Attach(attachment);
var result = email.Send();
```

å¦‚æœéœ€è¦æ·»åŠ å¤šä¸ªé™„ä»¶çš„è¯Attachæ–¹æ³•æ”¯æŒä¼ å…¥Attachmenté›†åˆ

```C#
//æ„å»ºé™„ä»¶
var stream = new MemoryStream();
var sw = new StreamWriter(stream);
sw.WriteLine("æ‚¨å¥½,è¿™æ˜¯æ–‡æœ¬é‡Œçš„å†…å®¹");
sw.Flush();
stream.Seek(0, SeekOrigin.Begin);
//é™„ä»¶1
var attachment = new FluentEmail.Core.Models.Attachment
{
    Data = stream,
    ContentType = "text/plain",
    Filename = "Hello.txt"
};

//é™„ä»¶2
var attachment2 = new FluentEmail.Core.Models.Attachment
{
    Data = File.OpenRead(@"D:\test.txt"),
    ContentType = "text/plain",
    Filename = "test.txt"
};

//æ·»åŠ é™„ä»¶
email.Attach(new List<FluentEmail.Core.Models.Attachment> { attachment, attachment2 });
var result = email.Send();
```

## ä½¿ç”¨Razoræ¨¡æ¿

ä¸Šé¢çš„å†…å®¹æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨FluentEmailä½¿ç”¨å¸¸è§„çš„æ–¹å¼å‘é€é‚®ä»¶ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å‘é€ä¸€äº›å†…å®¹æ˜¯åŠ¨æ€çš„æˆ–è€…å‘é€ä¸€äº›æ ·å¼æ¯”è¾ƒå¤æ‚htmlç½‘é¡µå†…å®¹ã€‚é€šå¸¸æˆ‘ä»¬ä½¿ç”¨åŸç”Ÿçš„SmptClientçš„æ—¶å€™éƒ½æ˜¯é€šè¿‡æ‹¼æ¥htmlä»£ç æ–¹å¼ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ç›¸å¯¹æ¥è¯´æ¯”è¾ƒè´¹æ—¶è´¹åŠ›ï¼Œå¯¹äº.Netç¨‹åºå‘˜æ¥è¯´Razorå¼•æ“æ˜¯æˆ‘ä»¬æ„å»ºåŠ¨æ€htmlé¡µé¢æœ€ç†Ÿæ‚‰çš„æ–¹å¼ï¼Œè€ŒFluentEmailæ­£æ˜¯ä¸ºæˆ‘ä»¬æä¾›äº†Razoræ¨¡æ¿çš„æ”¯æŒã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šå¼•å…¥FluentEmail.Razoræ¨¡æ¿æ”¯æŒç»„ä»¶

```xml
<PackageReference Include="FluentEmail.Razor" Version="2.8.0" />
```

ç”±äºASP.NET Core2.2å¼€å§‹é»˜è®¤æ˜¯ä½¿ç”¨çš„è§†å›¾ç¼–è¯‘åŠŸèƒ½ï¼Œè§†å›¾ä¼šç¼–è¯‘æˆ é¡¹ç›®åç§°.Views.dllï¼Œä½†æ˜¯FluentEmail.Razoråˆéœ€è¦è¯»å–è§†å›¾æ–‡ä»¶çš„å†…å®¹ï¼Œæ‰€ä»¥è¦åœ¨csprojæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹

```xml
<MvcRazorExcludeRefAssembliesFromPublish>true</MvcRazorExcludeRefAssembliesFromPublish>
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Razoræ¨¡æ¿ç”Ÿæˆé‚®ä»¶å†…å®¹ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼

```C#
//å£°æ˜ä½¿ç”¨razorçš„æ–¹å¼
Email.DefaultRenderer = new RazorRenderer();
//razorå†…å®¹
var template = "ä½ å¥½@Model.Nameå…ˆç”Ÿ, è¯·æ ¸å®æ‚¨çš„ç”µè¯å·ç æ˜¯å¦ä¸º@Model.Phone";
var email = Email
    .From("lisi@126.com")
    .To("zhangsan@qq.com")
    .Subject("æ‰‹æœºå·æ ¸å®")
    //ä¼ é€’è‡ªå®šä¹‰POCOç±»
    //.UsingTemplate<UserInfo>(template, new UserInfo { Name = "å¼ ä¸‰", Phoneå— = "100110119120" })
    //æˆ–ä¼ é€’åŒ¿åå¯¹è±¡
    .UsingTemplate(template, new { Name = "å¼ ä¸‰", Phoneå— = "100110119120" });
var result = await email.SendAsync();
```

å½“ç„¶å®ƒæ”¯æŒçš„æ–¹å¼ä¸ä»…ä»…åªæ˜¯Razorå­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥ä¼ é€’Razorè§†å›¾æ–‡ä»¶

```C#
var email = Email
    .From("lisi@126.com")
    .To("zhangsan@qq.com")
    .Subject("æ‰‹æœºå·æ ¸å®")
    //ä¼ é€’è‡ªå®šä¹‰POCOç±»
    //.UsingTemplateFromFile<UserInfo>($"{Directory.GetCurrentDirectory()}/template.cshtml", 
    //     new UserInfo { Name = "å¼ ä¸‰", Phoneå— = "100110119120" });
    //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè§†å›¾æ–‡ä»¶ä½ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ¨¡å‹å¯¹è±¡
    .UsingTemplateFromFile($"{Directory.GetCurrentDirectory()}/template.cshtml", 
       new { Name = "å¼ ä¸‰", Phoneå— = "100110119120" });
var result = await email.SendAsync();
```

FluentEmail.Razorä¹‹æ‰€ä»¥èƒ½å¤Ÿæ”¯æŒå¼ºå¤§çš„Razoræ¨¡æ¿å¼•æ“ï¼Œä¸»è¦æ˜¯å¾—ç›Šäºå®ƒå†…éƒ¨é›†æˆäº†RazorLightï¼Œè¿™æ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„Razorå¼•æ“ï¼Œå¯ä»¥å°†Razoræ¨¡æ¿å­—ç¬¦ä¸²æˆ–è€…Razorè§†å›¾æ–‡ä»¶è§£ææˆå…·ä½“çš„å­—ç¬¦ä¸²ç»“æœï¼Œå…·ä½“è¯¦æƒ…å¯å‚é˜…RazorLightå®˜æ–¹GitHubåœ°å€https://github.com/toddams/RazorLightï¼Œç›®å‰æ­£å¼ç‰ˆå¹¶ä¸æ”¯æŒ.Net Coreï¼Œå¯ä»¥é€‰æ‹©ä¸‹è½½betaç‰ˆæœ¬

```shell
Install-Package RazorLight -Version 2.0.0-beta10
```

å®ƒçš„ä½¿ç”¨æ–¹å¼ä¹Ÿéå¸¸ç®€å•

```C#
//razorå­—ç¬¦ä¸²çš„æ–¹å¼
var engine = new RazorLightEngineBuilder()
	.UseEmbeddedResourcesProject(typeof(Program))
	.UseMemoryCachingProvider()
	.Build();
string template = "Hello, @Model.Name. Welcome to RazorLight repository";
ViewModel model = new ViewModel {Name = "John Doe"};
//resultå°±æ˜¯è§£æåçš„å­—ç¬¦ä¸²
string result = await engine.CompileRenderStringAsync("templateKey", template, model);
```

æˆ–ä½¿ç”¨razorè§†å›¾æ–‡ä»¶çš„æ–¹å¼

```C#
var engine = new RazorLightEngineBuilder()
	.UseFileSystemProject("${Directory.GetCurrentDirectory()}")
	.UseMemoryCachingProvider()
	.Build();
var model = new {Name = "John Doe"};
string result = await engine.CompileRenderAsync("template.cshtml", model);
```

å½“ç„¶å®ƒæ”¯æŒçš„æ–¹å¼ä¸ä»…ä»…åªæœ‰è¿™ä¸¤ç§ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ä¾¿æ·ç¨‹åº¦è¿˜æ˜¯åŠŸèƒ½ä¸Šéƒ½éå¸¸çš„å¼ºå¤§ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…RazorLightçš„GitHubåœ°å€ï¼Œè®²è§£çš„è¿˜æ˜¯éå¸¸è¯¦ç»†çš„ã€‚åœ¨è¿™é‡Œå°±ä¸åœ¨è¿‡å¤šçš„è®¨è®ºå…³äºRazorLightçš„ä½¿ç”¨æ–¹å¼äº†ã€‚

å…³äºå‘é€çš„é‚®ä»¶å†…å®¹,è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹éœ€è¦å‹æƒ…æç¤ºä¸€ä¸‹`å…¬å…±é‚®ç®±è¿è¥å•†æ¯”å¦‚ç½‘æ˜“æˆ–è…¾è®¯ï¼Œæœ‰çš„å¯èƒ½éœ€è¦æ‰‹åŠ¨å¼€å¯SMTPæœåŠ¡`,å…·ä½“å¦‚ä½•è®¾ç½®å¯ä»¥å‚è€ƒhttps://blog.csdn.net/c13_tianming/article/details/47660635ä¸€æ–‡ã€‚è¿˜æœ‰ä¸€ç‚¹ä¹Ÿæ¯”è¾ƒé‡è¦`å¦‚æœä½ ä½¿ç”¨å…¬å…±é‚®ç®±è¿è¥å•†çš„é‚®ç®±é‚£ä¹ˆä»–ä»¬ä¼šå¯¹é‚®ä»¶çš„æ ‡é¢˜å’Œå†…å®¹é™åˆ¶æ¯”è¾ƒå¤§ï¼Œå¯èƒ½å‡ºç°çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œè€Œä¸”å¼€å¯SmtpæœåŠ¡éœ€è¦å‘é€çŸ­ä¿¡è®¤è¯æ‰èƒ½å¼€å¯`ã€‚å¥½åœ¨å¤§éƒ¨åˆ†å…¬å¸éƒ½æœ‰è‡ªå·±çš„é‚®ä»¶ç³»ç»Ÿï¼Œåœ¨å®é™…å‘é€é‚®ä»¶çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¸ä¼šå­˜åœ¨è¿™ä¹ˆå¤šçš„é—®é¢˜ã€‚

**ç»“åˆä¾èµ–æ³¨å…¥ä½¿ç”¨**

åœ¨ä½¿ç”¨.Net Coreçš„å®é™…å¼€å‘ä¸­ï¼Œä¾èµ–æ³¨å…¥å·²ç»æˆä¸ºäº†å¿…ä¸å¯å°‘çš„å¼€å‘æ¨¡å¼ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨.Net Coreå¼€å‘é¡¹ç›®ï¼Œä½†æ˜¯ä½ è¿˜æ²¡æœ‰æ¥è§¦ä¾èµ–æ³¨å…¥ï¼Œé‚£ä¹ˆéœ€è¦ä½ å…ˆè‡ªè¡Œåçœä¸€ä¸‹ã€‚FluentEmailä½œä¸ºä¸€æ¬¾ä¸æ—¶ä¿±è¿›çš„ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥ç»“åˆä¾èµ–æ³¨å…¥ä½¿ç”¨ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥åœ¨æ³¨å†Œçš„æ—¶å€™ç»Ÿä¸€çš„é…ç½®ä¸€äº›é»˜è®¤çš„è®¾ç½®ã€‚è¿™æ³¢æ“ä½œå°±ä¸éœ€è¦é¢å¤–å¼•å…¥ä¸€äº›åˆ«çš„åŒ…äº†ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨Smtpå°±å¼•å…¥FluentEmail.SmtpåŒ…ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨Razoræ¨¡æ¿å°±å¼•å…¥FluentEmail.RazoråŒ…ï¼Œå…³äºæ³¨å…¥çš„è¿™ä¸€éƒ¨åˆ†çš„åŠŸèƒ½å…¶å®æ˜¯åŒ…å«åœ¨FluentEmail.CoreåŒ…é‡Œé¢çš„

```C#
public void ConfigureServices(IServiceCollection services)
{
    SmtpClient smtp = new SmtpClient
    {
        //smtpæœåŠ¡å™¨åœ°å€(æˆ‘è¿™é‡Œä»¥126é‚®ç®±ä¸ºä¾‹ï¼Œå¯ä»¥ä¾æ®å…·ä½“ä½ ä½¿ç”¨çš„é‚®ç®±è®¾ç½®)
        Host = "smtp.qq.com",
        UseDefaultCredentials = true,
        DeliveryMethod = SmtpDeliveryMethod.Network,
        //è¿™é‡Œè¾“å…¥ä½ åœ¨å‘é€smtpæœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç 
        Credentials = new NetworkCredential("zhangsan@qq.com", "zhangsan")
    };
    //æ³¨å…¥çš„æ—¶å€™å¯ä»¥æ·»åŠ ä¸€äº›é»˜è®¤çš„è®¾ç½®
    services
        //è®¾ç½®é»˜è®¤å‘é€ç”¨æˆ·
        .AddFluentEmail("zhangsan@qq.com")
        //æ·»åŠ razoræ¨¡æ¿æ”¯æŒ
        //.AddRazorRenderer($"{Directory.GetCurrentDirectory()}/Views")
        .AddRazorRenderer()
        //é…ç½®é»˜è®¤çš„smtpæœåŠ¡ä¿¡æ¯
        .AddSmtpSender(smtp);
}
```

åœ¨éœ€è¦å‘é€é‚®ä»¶çš„ç±»ä¸­ç›´æ¥æ³¨å…¥IFluentEmail,ä¸å¿…æƒŠæ…Œå’±ä»¬ä¸Šé¢ä½¿ç”¨çš„Emailè¿™ä¸ªç±»å…¶å®å°±æ˜¯å®ç°äº†IFluentEmailè¿™ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä½¿ç”¨æ–¹å¼ä¸Šæ˜¯å®Œå…¨ä¸€è‡´çš„

```C#
public async Task<IActionResult> SendEmail([FromServices]IFluentEmail email)
{
     var result = await email//å‘é€äºº
        //å‘é€äºº
        .From("zhangsan@126.com")
        //æ”¶ä»¶äºº
        .To("lisi@qq.com")
        //æŠ„é€äºº
        .CC("admin@126.com")
        //é‚®ä»¶æ ‡é¢˜
        .Subject("é‚®ä»¶æ ‡é¢˜")
        //é‚®ä»¶å†…å®¹
       .Body("é‚®ä»¶å†…å®¹").SendAsync();
    return View();
}
```

å¦‚æœä½ éœ€è¦å‘é€Razorè§†å›¾æ¨¡æ¿ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿè¿˜æ˜¯é‚£ä¸ªç†Ÿæ‚‰çš„é…æ–¹é‚£ä¸ªç†Ÿæ‚‰çš„å‘³é“ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¸åŒï¼Œåªæ˜¯çœç•¥äº†ä¸€äº›æˆ‘ä»¬åœ¨æ³¨å†Œçš„æ—¶å€™æ·»åŠ çš„ä¸€äº›é»˜è®¤é…ç½®

```C#
public async Task<IActionResult> SendEmail([FromServices]IFluentEmail email)
{
     var template = "ä½ å¥½@Model.Nameå…ˆç”Ÿ, è¯·æ ¸å®æ‚¨çš„ç”µè¯å·ç æ˜¯å¦ä¸º@Model.Phone";
     var result = await email//å‘é€äºº
        .From("lisi@126.com")
        .To("zhangsan@qq.com")
        .Subject("æ‰‹æœºå·æ ¸å®")
        //ä¼ é€’è‡ªå®šä¹‰POCOç±»
        //.UsingTemplate<UserInfo>(template, new UserInfo { Name = "å¼ ä¸‰", Phoneå— = "100110119120" })
        //æˆ–ä¼ é€’åŒ¿åå¯¹è±¡
        .UsingTemplate(template, new { Name = "å¼ ä¸‰", Phoneå— = "100110119120" })
        .SendAsync();
    return View();
}
```

## æ€»ç»“

å…³äºFluentEmailçš„åŸºæœ¬ä½¿ç”¨æ–¹å¼æˆ‘ä»¬å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰å®ƒè‡ªèº«çš„åŠŸèƒ½è¿˜æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥éå¸¸çš„ç®€å•ã€‚è¯´å®è¯åœ¨ä¹‹å‰æˆ‘æ²¡æ¥è§¦åˆ°FluentEmailä¹‹å‰ï¼Œæˆ‘ç»å¸¸åœ¨å›­å­é‡Œçœ‹åˆ°å…¶ä»–è¯­è¨€é›†æˆå‘é€é‚®ä»¶çš„ç»„ä»¶ï¼Œç¡®å®éå¸¸å¼ºå¤§ï¼Œæ¯”å¦‚åœ¨springbootä¸­é›†æˆspring-boot-starter-mailçœŸçš„æ˜¯éå¸¸çš„ä¾¿æ·ã€‚åæ¥æ— æ„ä¸­æ¥è§¦åˆ°äº†FluentEmailå¿ƒé‡Œè¿˜æ˜¯è›®æ¬£æ…°çš„ï¼Œä¸€æ˜¯å®ƒå¼ºå¤§çš„åŠŸèƒ½å’Œæ˜“ç”¨æ€§ï¼Œå…¶æ¬¡æ˜¯å¯ä»¥å»ç»“åˆ.Net Coreè¿›ä¸€æ­¥ä¼˜åŒ–äº†å®ƒçš„ä½¿ç”¨æ–¹å¼ï¼Œè‡³å°‘åœ¨.Netå’Œ.Net Coreä¸­æˆ‘ä»¬ä¹Ÿæ‹¥æœ‰ä¸€æ¬¾éå¸¸ä¾¿æ·çš„é‚®ä»¶å‘é€ç»„ä»¶ã€‚FluentEmailçš„ä½œè€…ä¹Ÿå‘¼åæ›´å¤šçš„å¼€å‘è€…èƒ½å¤Ÿäº†è§£å¹¶å‚ä¸åˆ°FluentEmailå¼€å‘å’Œå®è·µä¸­å»ï¼Œæœ€åå†æ¬¡è´´ä¸Šå®ƒçš„GitHubåœ°å€https://github.com/lukencode/FluentEmailï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»äº†è§£å­¦ä¹ ä¸€ä¸‹é¡ºä¾¿åˆ«å¿˜äº†ç»™ä¸ªStarã€‚


ğŸ‘‡æ¬¢è¿æ‰«ç å…³æ³¨æˆ‘çš„å…¬ä¼—å·ğŸ‘‡ 

![](https://lequ.co/2020/11/0301.png)